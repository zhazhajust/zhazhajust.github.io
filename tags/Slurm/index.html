<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><title>标签: Slurm - Jayz Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Jayz Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Jayz Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="website"><meta property="og:title" content="Jayz Blog"><meta property="og:url" content="https://zhazhajust.github.io/"><meta property="og:site_name" content="Jayz Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zhazhajust.github.io/img/og_image.png"><meta property="article:author" content="JayZz"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://zhazhajust.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhazhajust.github.io"},"headline":"Jayz Blog","image":["https://zhazhajust.github.io/img/og_image.png"],"author":{"@type":"Person","name":"JayZz"},"publisher":{"@type":"Organization","name":"Jayz Blog","logo":{"@type":"ImageObject"}},"description":""}</script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Jayz Blog</a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">标签</a></li><li class="is-active"><a href="#" aria-current="page">Slurm</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-02-02T07:40:21.000Z" title="2/2/2025, 3:40:21 PM">2025-02-02</time>发表</span><span class="level-item"><time dateTime="2025-12-21T00:09:45.381Z" title="12/21/2025, 8:09:45 AM">2025-12-21</time>更新</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/02/02/slurm-server/">CentOS Stream 9 单节点 Slurm 集群部署指南</a></p><div class="content"><p>本文提供 CentOS Stream 9 单节点环境下安装配置 Slurm（含 slurmctld + slurmd）的标准流程，适用于开发、测试及单机调度场景。</p>
<h2 id="一、环境假设与目标架构"><a href="#一、环境假设与目标架构" class="headerlink" title="一、环境假设与目标架构"></a>一、环境假设与目标架构</h2><h3 id="1-环境假设"><a href="#1-环境假设" class="headerlink" title="1. 环境假设"></a>1. 环境假设</h3><ul>
<li>操作系统：CentOS Stream 9（最小化或标准安装）</li>
<li>主机名：node1</li>
<li>IP：192.168.1.10（示例）</li>
<li>角色：<ul>
<li>控制节点（Controller）：node1</li>
<li>计算节点（Compute）：node1</li>
</ul>
</li>
</ul>
<h3 id="2-Slurm-组件"><a href="#2-Slurm-组件" class="headerlink" title="2. Slurm 组件"></a>2. Slurm 组件</h3><ul>
<li>slurmctld：控制守护进程</li>
<li>slurmd：计算节点守护进程</li>
<li>slurmdbd：单机测试通常不需要</li>
</ul>
<h2 id="二、系统基础准备"><a href="#二、系统基础准备" class="headerlink" title="二、系统基础准备"></a>二、系统基础准备</h2><h3 id="1-设置主机名与-hosts"><a href="#1-设置主机名与-hosts" class="headerlink" title="1. 设置主机名与 hosts"></a>1. 设置主机名与 hosts</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname node1</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.1.10   node1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="2-关闭防火墙（测试环境建议）"><a href="#2-关闭防火墙（测试环境建议）" class="headerlink" title="2. 关闭防火墙（测试环境建议）"></a>2. 关闭防火墙（测试环境建议）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> --now firewalld</span><br></pre></td></tr></table></figure>

<h3 id="3-关闭-SELinux"><a href="#3-关闭-SELinux" class="headerlink" title="3. 关闭 SELinux"></a>3. 关闭 SELinux</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>

<h2 id="三、安装-Slurm-及依赖"><a href="#三、安装-Slurm-及依赖" class="headerlink" title="三、安装 Slurm 及依赖"></a>三、安装 Slurm 及依赖</h2><p>CentOS 9 官方仓库已包含 Slurm，无需自行编译。</p>
<h3 id="1-安装-EPEL"><a href="#1-安装-EPEL" class="headerlink" title="1. 安装 EPEL"></a>1. 安装 EPEL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y epel-release</span><br></pre></td></tr></table></figure>

<h3 id="2-安装-Slurm"><a href="#2-安装-Slurm" class="headerlink" title="2. 安装 Slurm"></a>2. 安装 Slurm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y slurm slurm-slurmd slurm-slurmctld munge</span><br></pre></td></tr></table></figure>

<h2 id="四、配置-Munge（Slurm-认证核心）"><a href="#四、配置-Munge（Slurm-认证核心）" class="headerlink" title="四、配置 Munge（Slurm 认证核心）"></a>四、配置 Munge（Slurm 认证核心）</h2><p>Slurm 强依赖 munge 进行节点认证。</p>
<h3 id="1-创建-munge-key"><a href="#1-创建-munge-key" class="headerlink" title="1. 创建 munge key"></a>1. 创建 munge key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/create-munge-key</span><br></pre></td></tr></table></figure>

<h3 id="2-设置权限"><a href="#2-设置权限" class="headerlink" title="2. 设置权限"></a>2. 设置权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R munge:munge /etc/munge /var/lib/munge /var/log/munge</span><br><span class="line"><span class="built_in">chmod</span> 400 /etc/munge/munge.key</span><br></pre></td></tr></table></figure>

<h3 id="3-启动-munge"><a href="#3-启动-munge" class="headerlink" title="3. 启动 munge"></a>3. 启动 munge</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now munge</span><br></pre></td></tr></table></figure>

<h3 id="4-验证-munge"><a href="#4-验证-munge" class="headerlink" title="4. 验证 munge"></a>4. 验证 munge</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">munge -n | unmunge</span><br></pre></td></tr></table></figure>
<p>正常应看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATUS:          Success (0)</span><br></pre></td></tr></table></figure>

<h2 id="五、创建-Slurm-用户与目录"><a href="#五、创建-Slurm-用户与目录" class="headerlink" title="五、创建 Slurm 用户与目录"></a>五、创建 Slurm 用户与目录</h2><h3 id="1-创建-slurm-用户"><a href="#1-创建-slurm-用户" class="headerlink" title="1. 创建 slurm 用户"></a>1. 创建 slurm 用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -r -s /sbin/nologin slurm</span><br></pre></td></tr></table></figure>

<h3 id="2-创建必要目录"><a href="#2-创建必要目录" class="headerlink" title="2. 创建必要目录"></a>2. 创建必要目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/spool/slurm/&#123;ctld,d&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p /var/log/slurm</span><br><span class="line"><span class="built_in">chown</span> -R slurm:slurm /var/spool/slurm /var/log/slurm</span><br></pre></td></tr></table></figure>

<h2 id="六、配置-slurm-conf（核心）"><a href="#六、配置-slurm-conf（核心）" class="headerlink" title="六、配置 slurm.conf（核心）"></a>六、配置 slurm.conf（核心）</h2><h3 id="1-生成基础模板"><a href="#1-生成基础模板" class="headerlink" title="1. 生成基础模板"></a>1. 生成基础模板</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/slurm/slurm.conf.example /etc/slurm/slurm.conf</span><br></pre></td></tr></table></figure>

<h3 id="2-编辑-etc-slurm-slurm-conf"><a href="#2-编辑-etc-slurm-slurm-conf" class="headerlink" title="2. 编辑 &#x2F;etc&#x2F;slurm&#x2F;slurm.conf"></a>2. 编辑 &#x2F;etc&#x2F;slurm&#x2F;slurm.conf</h3><p>最小可用单机配置示例：</p>
<p>slurm.conf 示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">############################</span><br><span class="line"># 基本集群信息</span><br><span class="line">############################</span><br><span class="line">ClusterName=single_cluster</span><br><span class="line">SlurmctldHost=node1(127.0.0.1)</span><br><span class="line">SlurmUser=slurm</span><br><span class="line">SlurmdUser=root</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 端口</span><br><span class="line">############################</span><br><span class="line">SlurmctldPort=6817</span><br><span class="line">SlurmdPort=6818</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 状态与日志</span><br><span class="line">############################</span><br><span class="line">StateSaveLocation=/var/spool/slurm/ctld</span><br><span class="line">SlurmdSpoolDir=/var/spool/slurm/d</span><br><span class="line">SlurmctldLogFile=/var/log/slurm/slurmctld.log</span><br><span class="line">SlurmdLogFile=/var/log/slurm/slurmd.log</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 认证</span><br><span class="line">############################</span><br><span class="line">AuthType=auth/munge</span><br><span class="line">CryptoType=crypto/munge</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 调度器</span><br><span class="line">############################</span><br><span class="line">SchedulerType=sched/backfill</span><br><span class="line">SchedulerParameters=bf_continue,bf_interval=30</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 资源选择（关键）</span><br><span class="line">############################</span><br><span class="line">SelectType=select/cons_res</span><br><span class="line">SelectTypeParameters=CR_Core_Memory</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># cgroup（生产必开）</span><br><span class="line">############################</span><br><span class="line">ProctrackType=proctrack/cgroup</span><br><span class="line">TaskPlugin=task/cgroup</span><br><span class="line"># TaskPluginParam=Sched</span><br><span class="line">JobAcctGatherType=jobacct_gather/cgroup</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 进程跟踪 / 清理</span><br><span class="line">############################</span><br><span class="line">KillOnBadExit=1</span><br><span class="line">ReturnToService=2</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 超时</span><br><span class="line">############################</span><br><span class="line">SlurmctldTimeout=300</span><br><span class="line">SlurmdTimeout=300</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 节点定义（按真实资源）</span><br><span class="line">############################</span><br><span class="line">NodeName=node1 \</span><br><span class="line">  CPUs=56 \</span><br><span class="line">  RealMemory=128027 \</span><br><span class="line">  Sockets=2 \</span><br><span class="line">  CoresPerSocket=28 \</span><br><span class="line">  ThreadsPerCore=1 \</span><br><span class="line">  Gres=gpu:V100:8 \</span><br><span class="line">  State=UNKNOWN</span><br><span class="line"></span><br><span class="line">GresTypes=gpu</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># 分区定义</span><br><span class="line">############################</span><br><span class="line">PartitionName=debug \</span><br><span class="line">  Nodes=node1 \</span><br><span class="line">  Default=YES \</span><br><span class="line">  MaxTime=1:00:00 \</span><br><span class="line">  State=UP</span><br><span class="line"></span><br><span class="line">PartitionName=normal \</span><br><span class="line">  Nodes=node1 \</span><br><span class="line">  MaxTime=7-00:00:00 \</span><br><span class="line">  State=UP</span><br></pre></td></tr></table></figure>

<p>cgroup.conf 示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">###</span><br><span class="line">#</span><br><span class="line"># Slurm cgroup support configuration file</span><br><span class="line">#</span><br><span class="line"># See man slurm.conf and man cgroup.conf for further</span><br><span class="line"># information on cgroup configuration parameters</span><br><span class="line">#--</span><br><span class="line">CgroupMountpoint=/sys/fs/cgroup</span><br><span class="line">CgroupAutomount=yes</span><br><span class="line"></span><br><span class="line">ConstrainCores=yes</span><br><span class="line">ConstrainRAMSpace=yes</span><br><span class="line">ConstrainSwapSpace=yes</span><br><span class="line">ConstrainDevices=yes</span><br><span class="line"></span><br><span class="line">AllowedRAMSpace=100</span><br><span class="line">AllowedSwapSpace=0</span><br><span class="line"></span><br><span class="line">MaxRAMPercent=98</span><br><span class="line">MaxSwapPercent=0</span><br><span class="line"></span><br><span class="line">MinRAMSpace=30</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li><code>CPUs</code> 和 <code>RealMemory</code> 根据 <code>lscpu</code>、<code>free -m</code> 实际调整</li>
<li><code>NodeName</code> 必须与 hostname 完全一致</li>
</ul>
<h2 id="七、启动-Slurm-服务"><a href="#七、启动-Slurm-服务" class="headerlink" title="七、启动 Slurm 服务"></a>七、启动 Slurm 服务</h2><h3 id="1-启动-slurmctld"><a href="#1-启动-slurmctld" class="headerlink" title="1. 启动 slurmctld"></a>1. 启动 slurmctld</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now slurmctld</span><br></pre></td></tr></table></figure>

<h3 id="2-启动-slurmd"><a href="#2-启动-slurmd" class="headerlink" title="2. 启动 slurmd"></a>2. 启动 slurmd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now slurmd</span><br></pre></td></tr></table></figure>

<h2 id="八、验证-Slurm-状态"><a href="#八、验证-Slurm-状态" class="headerlink" title="八、验证 Slurm 状态"></a>八、验证 Slurm 状态</h2><h3 id="1-查看节点状态"><a href="#1-查看节点状态" class="headerlink" title="1. 查看节点状态"></a>1. 查看节点状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sinfo</span><br></pre></td></tr></table></figure>
<p>期望输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST</span><br><span class="line">debug        up   infinite      1   idle node1</span><br></pre></td></tr></table></figure>

<h3 id="2-查看节点详情"><a href="#2-查看节点详情" class="headerlink" title="2. 查看节点详情"></a>2. 查看节点详情</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scontrol show node node1</span><br></pre></td></tr></table></figure>

<h2 id="九、提交测试任务"><a href="#九、提交测试任务" class="headerlink" title="九、提交测试任务"></a>九、提交测试任务</h2><h3 id="1-交互式任务"><a href="#1-交互式任务" class="headerlink" title="1. 交互式任务"></a>1. 交互式任务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -n 1 hostname</span><br></pre></td></tr></table></figure>

<h3 id="2-批处理任务"><a href="#2-批处理任务" class="headerlink" title="2. 批处理任务"></a>2. 批处理任务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; test.sh &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">#SBATCH -n 1</span></span><br><span class="line"><span class="string">#SBATCH -o test.out</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hostname</span></span><br><span class="line"><span class="string">sleep 10</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sbatch test.sh</span><br></pre></td></tr></table></figure>

<p>查看任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">squeue</span><br></pre></td></tr></table></figure>

<h2 id="十、常见问题排查"><a href="#十、常见问题排查" class="headerlink" title="十、常见问题排查"></a>十、常见问题排查</h2><h3 id="1-节点状态为-DOWN"><a href="#1-节点状态为-DOWN" class="headerlink" title="1. 节点状态为 DOWN"></a>1. 节点状态为 DOWN</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scontrol update NodeName=node1 State=RESUME</span><br></pre></td></tr></table></figure>

<h3 id="2-查看日志"><a href="#2-查看日志" class="headerlink" title="2. 查看日志"></a>2. 查看日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u slurmctld -f</span><br><span class="line">journalctl -u slurmd -f</span><br></pre></td></tr></table></figure>

<h3 id="3-Munge-错误"><a href="#3-Munge-错误" class="headerlink" title="3. Munge 错误"></a>3. Munge 错误</h3><ul>
<li>确认 munge 正在运行</li>
<li><code>/etc/munge/munge.key</code> 权限必须是 400</li>
</ul>
<h2 id="十一、slurmdbd-需求分析"><a href="#十一、slurmdbd-需求分析" class="headerlink" title="十一、slurmdbd 需求分析"></a>十一、slurmdbd 需求分析</h2><table>
<thead>
<tr>
<th>场景</th>
<th>是否需要</th>
</tr>
</thead>
<tbody><tr>
<td>单机测试</td>
<td>否</td>
</tr>
<tr>
<td>作业计费&#x2F;统计</td>
<td>是</td>
</tr>
<tr>
<td>多用户审计</td>
<td>是</td>
</tr>
</tbody></table>
<p>如需以下扩展配置，请说明使用场景：</p>
<ul>
<li>CentOS 9 + slurmdbd + MariaDB 配置</li>
<li>GPU（NVIDIA）节点配置</li>
<li>cgroup 资源隔离详细配置</li>
<li>多节点集群扩展方案</li>
</ul>
<h2 id="十二、GPU-配置（V100-示例）"><a href="#十二、GPU-配置（V100-示例）" class="headerlink" title="十二、GPU 配置（V100 示例）"></a>十二、GPU 配置（V100 示例）</h2><h3 id="1-确认-GPU-设备"><a href="#1-确认-GPU-设备" class="headerlink" title="1. 确认 GPU 设备"></a>1. 确认 GPU 设备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /dev/nvidia*</span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/dev/nvidia0</span><br><span class="line">/dev/nvidia1</span><br><span class="line">/dev/nvidiactl</span><br><span class="line">/dev/nvidia-uvm</span><br></pre></td></tr></table></figure>

<h3 id="2-配置-gres-conf"><a href="#2-配置-gres-conf" class="headerlink" title="2. 配置 gres.conf"></a>2. 配置 gres.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/slurm/gres.conf</span><br></pre></td></tr></table></figure>
<p>示例（2 × V100）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NodeName=node1 Name=gpu Type=V100 File=/dev/nvidia0</span><br><span class="line">NodeName=node1 Name=gpu Type=V100 File=/dev/nvidia1</span><br></pre></td></tr></table></figure>

<p><strong>要点</strong>：</p>
<ul>
<li><code>Type=V100</code> 是 <code>--gres=gpu:V100:x</code> 参数的关键</li>
<li><code>NodeName</code> 必须和 slurm.conf 完全一致</li>
</ul>
<h3 id="3-修改-slurm-conf"><a href="#3-修改-slurm-conf" class="headerlink" title="3. 修改 slurm.conf"></a>3. 修改 slurm.conf</h3><p>在节点定义中添加 GPU 资源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NodeName=node1 \</span><br><span class="line">  CPUs=64 \</span><br><span class="line">  RealMemory=125000 \</span><br><span class="line">  Gres=gpu:V100:2 \</span><br><span class="line">  State=UNKNOWN</span><br></pre></td></tr></table></figure>

<h3 id="4-启用-GPU-隔离"><a href="#4-启用-GPU-隔离" class="headerlink" title="4. 启用 GPU 隔离"></a>4. 启用 GPU 隔离</h3><p>确认 <code>/etc/slurm/cgroup.conf</code> 包含：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConstrainDevices=yes</span><br></pre></td></tr></table></figure>
<p><strong>重要</strong>：未启用隔离会导致所有作业都能访问全部 GPU</p>
<h3 id="5-重启服务"><a href="#5-重启服务" class="headerlink" title="5. 重启服务"></a>5. 重启服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart slurmctld slurmd</span><br></pre></td></tr></table></figure>

<h2 id="十三、GPU-功能验证"><a href="#十三、GPU-功能验证" class="headerlink" title="十三、GPU 功能验证"></a>十三、GPU 功能验证</h2><h3 id="1-查看节点资源"><a href="#1-查看节点资源" class="headerlink" title="1. 查看节点资源"></a>1. 查看节点资源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scontrol show node node1</span><br></pre></td></tr></table></figure>
<p>应包含：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Gres=gpu:V100:2</span><br><span class="line">GresUsed=0</span><br></pre></td></tr></table></figure>

<h3 id="2-查看-GPU-视图"><a href="#2-查看-GPU-视图" class="headerlink" title="2. 查看 GPU 视图"></a>2. 查看 GPU 视图</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sinfo -o <span class="string">&quot;%N %G&quot;</span></span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node1 gpu:V100:2</span><br></pre></td></tr></table></figure>

<h2 id="十四、GPU-作业示例"><a href="#十四、GPU-作业示例" class="headerlink" title="十四、GPU 作业示例"></a>十四、GPU 作业示例</h2><h3 id="1-交互式任务（单-GPU）"><a href="#1-交互式任务（单-GPU）" class="headerlink" title="1. 交互式任务（单 GPU）"></a>1. 交互式任务（单 GPU）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">srun --gres=gpu:V100:1 --pty bash</span><br><span class="line">nvidia-smi  <span class="comment"># 应只看到1张GPU</span></span><br></pre></td></tr></table></figure>

<h3 id="2-批处理任务-1"><a href="#2-批处理任务-1" class="headerlink" title="2. 批处理任务"></a>2. 批处理任务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; gpu_test.sh &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -J gpu_test</span></span><br><span class="line"><span class="comment">#SBATCH --gres=gpu:V100:1</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=4</span></span><br><span class="line"><span class="comment">#SBATCH --mem=16G</span></span><br><span class="line"><span class="comment">#SBATCH -o gpu_test.out</span></span><br><span class="line"></span><br><span class="line">nvidia-smi</span><br><span class="line"><span class="built_in">sleep</span> 30</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sbatch gpu_test.sh</span><br></pre></td></tr></table></figure>

<h3 id="3-多-GPU-任务"><a href="#3-多-GPU-任务" class="headerlink" title="3. 多 GPU 任务"></a>3. 多 GPU 任务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun --gres=gpu:V100:2 --pty bash</span><br></pre></td></tr></table></figure>

<h2 id="十五、常见-GPU-问题"><a href="#十五、常见-GPU-问题" class="headerlink" title="十五、常见 GPU 问题"></a>十五、常见 GPU 问题</h2><h3 id="❌-作业内能看到所有-GPU"><a href="#❌-作业内能看到所有-GPU" class="headerlink" title="❌ 作业内能看到所有 GPU"></a>❌ 作业内能看到所有 GPU</h3><p><strong>原因</strong>：</p>
<ul>
<li><code>ConstrainDevices=no</code></li>
<li>未使用 <code>task/cgroup</code></li>
</ul>
<p><strong>修复</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ConstrainDevices=yes</span><br><span class="line">TaskPlugin=task/cgroup</span><br></pre></td></tr></table></figure>

<h3 id="❌-提交-GPU-作业一直排队"><a href="#❌-提交-GPU-作业一直排队" class="headerlink" title="❌ 提交 GPU 作业一直排队"></a>❌ 提交 GPU 作业一直排队</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">squeue</span><br><span class="line">scontrol show job &lt;jobid&gt;</span><br></pre></td></tr></table></figure>
<p><strong>常见原因</strong>：</p>
<ul>
<li>GPU 已被占用</li>
<li>请求的 GPU 类型错误（如写成 A100）</li>
</ul>
<h3 id="❌-GPU-规格指定差异"><a href="#❌-GPU-规格指定差异" class="headerlink" title="❌ GPU 规格指定差异"></a>❌ GPU 规格指定差异</h3><table>
<thead>
<tr>
<th>写法</th>
<th>行为</th>
</tr>
</thead>
<tbody><tr>
<td><code>--gres=gpu:1</code></td>
<td>使用任意 GPU</td>
</tr>
<tr>
<td><code>--gres=gpu:V100:1</code></td>
<td>仅使用 V100</td>
</tr>
</tbody></table>
<p>生产环境建议始终指定 GPU 类型</p>
<h2 id="十六、生产环境建议"><a href="#十六、生产环境建议" class="headerlink" title="十六、生产环境建议"></a>十六、生产环境建议</h2><h3 id="1-资源限制"><a href="#1-资源限制" class="headerlink" title="1. 资源限制"></a>1. 资源限制</h3><p>在分区配置中添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DefMemPerGPU=32000  # 每GPU分配32GB内存</span><br></pre></td></tr></table></figure>
<p>避免 GPU 作业抢占全部内存</p>
<h3 id="2-节点隔离"><a href="#2-节点隔离" class="headerlink" title="2. 节点隔离"></a>2. 节点隔离</h3><p>未来扩展多节点时，使用独立分区区分 GPU&#x2F;CPU 节点</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>V100 GPU 的配置需要同时满足：</p>
<ol>
<li>正确的 <code>gres.conf</code> 定义</li>
<li><code>slurm.conf</code> 中的资源声明</li>
<li><code>cgroup.conf</code> 的设备隔离</li>
</ol>
<p>根据需求可进一步配置：</p>
<ul>
<li>MIG &#x2F; 多 GPU 混合调度</li>
<li>GPU + CPU 绑核（NUMA 亲和）</li>
<li>GPU 分区 &#x2F; QOS</li>
<li>多用户 GPU 计费</li>
</ul>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/icon.png" alt="JayZz"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">JayZz</p><p class="is-size-6 is-block">开发者</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>城市, 国家</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">25</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">6</p></a></div></div></nav></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-12-21T00:00:00.000Z">2025-12-21</time></p><p class="title"><a href="/2025/12/21/linux-cgroup-ssh-limit/">Linux cgroup 实现 SSH 用户资源限制指南</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-27T00:00:00.000Z">2025-02-27</time></p><p class="title"><a href="/2025/02/27/rel_mom/">广义动量守恒推导</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-02T07:40:21.000Z">2025-02-02</time></p><p class="title"><a href="/2025/02/02/cloudflare/">Cloudflare tunnel 内网穿透</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-02T07:40:21.000Z">2025-02-02</time></p><p class="title"><a href="/2025/02/02/slurm-server/">CentOS Stream 9 单节点 Slurm 集群部署指南</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-02-02T03:26:21.000Z">2025-02-02</time></p><p class="title"><a href="/2025/02/02/subtree/">Subtree仓库添加</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Jayz Blog</a><p class="is-size-7"><span>&copy; 2025 JayZz</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><!--!--><script data-pjax src="/js/main.js" defer></script><!--!--></body></html>